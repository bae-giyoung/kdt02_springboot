<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>OAuth2 Callback</title>
<script>
window.onload = async () => {
	try{
		// 서버로 콜백 요청
		let response = await fetch("/api/jwtcallback", {
			method: "POST",
			credentials: "include" // 쿠키 포함해서 전송
		});
		
		if(response.ok) {
			const jwtToken = response.headers.get('Authorization');
			if(jwtToken) {
				sessionStorage.setItem('jwtToken', jwtToken);
				alert('로그인 성공!');
				window.location.href="./welcome.html";
				return;
			}
		} else {
			alert("JWT 검증 실패");
		}
		
	} catch(error) {
		console.error(error);
		alert("서버 요청 오류");
	}
	
	window.location.href="./login.html";
}
</script>
</head>
<body>
	<p>로그인 처리중...</p>
</body>
</html>